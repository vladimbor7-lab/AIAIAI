<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="eQLYZuNE5GdeqmgsmkxX_kFKtL-uAEseBGpiXSUV0xs">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3385XBMVEW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-3385XBMVEW');
</script>
<title>Travel AI — Войти</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --c1:#0f172a;--a:#2563eb;--at:rgba(37,99,235,.1);
  --g:#f8fafc;--g2:#f1f5f9;--g3:#e2e8f0;
  --tx:#0f172a;--tx2:#475569;--tx3:#94a3b8;--wh:#fff;
  --font:'Inter',-apple-system,sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:var(--font);background:var(--g);color:var(--tx);min-height:100svh;display:flex;flex-direction:column;-webkit-font-smoothing:antialiased;}

nav{background:rgba(255,255,255,.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--g3);padding:0 56px;}
.nav-in{max-width:1140px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:60px;}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;}
.logo-mark{width:32px;height:32px;background:var(--a);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:15px;}
.logo-text{font-size:17px;font-weight:700;color:var(--tx);letter-spacing:-.3px;}
.logo-text span{color:var(--a);}
.nav-back{font-size:13px;color:var(--tx3);text-decoration:none;font-weight:500;transition:color .15s;}
.nav-back:hover{color:var(--tx);}

main{flex:1;display:flex;align-items:center;justify-content:center;padding:40px 24px;}

.card{background:#fff;border:1.5px solid var(--g3);border-radius:20px;padding:40px;width:100%;max-width:420px;box-shadow:0 4px 24px rgba(0,0,0,.06);}

.card-title{font-size:24px;font-weight:800;color:var(--tx);letter-spacing:-.5px;margin-bottom:4px;}
.card-sub{font-size:14px;color:var(--tx3);margin-bottom:32px;}

.tabs{display:flex;background:var(--g);border-radius:10px;padding:3px;margin-bottom:24px;}
.tab{flex:1;padding:8px;text-align:center;font-size:13px;font-weight:600;color:var(--tx3);border-radius:8px;cursor:pointer;transition:all .15s;}
.tab.active{background:#fff;color:var(--tx);box-shadow:0 1px 3px rgba(0,0,0,.08);}

.fld{display:flex;flex-direction:column;gap:5px;margin-bottom:14px;}
.fld label{font-size:11px;font-weight:700;color:var(--tx3);letter-spacing:.3px;text-transform:uppercase;}
.fld input{background:var(--g);border:1.5px solid var(--g3);border-radius:10px;padding:11px 13px;font-family:var(--font);font-size:14px;color:var(--tx);outline:none;transition:border .15s;}
.fld input::placeholder{color:var(--tx3);}
.fld input:focus{border-color:var(--a);background:#fff;}

.hint{font-size:11px;color:var(--tx3);margin-top:2px;}

.submit{width:100%;padding:13px;background:var(--a);color:#fff;border:none;border-radius:10px;font-family:var(--font);font-size:15px;font-weight:700;cursor:pointer;transition:all .2s;margin-top:4px;}
.submit:hover{background:#1d4ed8;transform:translateY(-1px);box-shadow:0 6px 20px rgba(37,99,235,.25);}
.submit:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none;}

.alert{display:none;padding:10px 14px;border-radius:8px;font-size:13px;margin-bottom:14px;}
.alert.err{background:#fef2f2;border:1px solid #fecaca;color:#dc2626;}
.alert.ok{background:#f0fdf4;border:1px solid #bbf7d0;color:#16a34a;}

.divider{display:flex;align-items:center;gap:12px;margin:20px 0;color:var(--tx3);font-size:12px;}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--g3);}

.api-note{background:var(--at);border:1px solid rgba(37,99,235,.15);border-radius:10px;padding:12px 14px;font-size:12px;color:var(--a);line-height:1.6;}
.api-note strong{font-weight:700;}

footer{padding:20px 56px;border-top:1px solid var(--g3);text-align:center;}
.fcopy{font-size:12px;color:var(--tx3);}

.sp{display:inline-block;width:13px;height:13px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;margin-right:6px;vertical-align:middle;}
@keyframes spin{to{transform:rotate(360deg);}}
</style>
</head>
<body>

<nav>
  <div class="nav-in">
    <a class="logo" href="index.html">
      <div class="logo-mark">T</div>
      <div class="logo-text">Travel<span>AI</span></div>
    </a>
    <a class="nav-back" href="index.html">← На главную</a>
  </div>
</nav>

<main>
  <div class="card">
    <div class="card-title">Войти в панель</div>
    <div class="card-sub">Управляйте ботом, смотрите заявки</div>

    <div class="tabs">
      <div class="tab active" onclick="switchTab('key')">По API-ключу</div>
      <div class="tab" onclick="switchTab('pass')">По паролю</div>
    </div>

    <div id="alert" class="alert"></div>

    <!-- KEY TAB -->
    <div id="tabKey">
      <div class="fld">
        <label>API-ключ агентства</label>
        <input type="text" id="apiKey" placeholder="ragency_xxxxxxxxxxxxxxxx">
        <div class="hint">Ключ выдаётся при подключении</div>
      </div>
      <button class="submit" id="btnKey" onclick="loginByKey()">Войти →</button>
      <div class="divider">или</div>
      <div class="api-note"><strong>Ещё нет ключа?</strong> Оставьте заявку на главной — подключим за 24 часа и вышлем ключ.</div>
    </div>

    <!-- PASS TAB -->
    <div id="tabPass" style="display:none;">
      <div class="fld">
        <label>Email</label>
        <input type="email" id="loginEmail" placeholder="agency@example.com">
      </div>
      <div class="fld">
        <label>Пароль</label>
        <input type="password" id="loginPass" placeholder="••••••••"
          onkeydown="if(event.key==='Enter')loginByPass()">
      </div>
      <button class="submit" id="btnPass" onclick="loginByPass()">Войти →</button>
    </div>
  </div>
</main>

<footer><div class="fcopy">© 2026 Travel AI</div></footer>

<script>
const API = 'https://roman-backend-production.up.railway.app';

function switchTab(t) {
  document.querySelectorAll('.tab').forEach((el,i) => el.classList.toggle('active', (i===0&&t==='key')||(i===1&&t==='pass')));
  document.getElementById('tabKey').style.display = t==='key' ? '' : 'none';
  document.getElementById('tabPass').style.display = t==='pass' ? '' : 'none';
  showAlert('','');
}

function showAlert(msg, type) {
  const el = document.getElementById('alert');
  el.textContent = msg;
  el.className = 'alert' + (type ? ' '+type : '');
  el.style.display = msg ? 'block' : 'none';
}

async function loginByKey() {
  const key = document.getElementById('apiKey').value.trim();
  if (!key) { showAlert('Введите API-ключ', 'err'); return; }
  const btn = document.getElementById('btnKey');
  btn.disabled = true; btn.innerHTML = '<span class="sp"></span>Проверяем...';
  try {
    const res = await fetch(`${API}/api/agency/config`, { headers: { 'x-agency-key': key } });
    if (res.ok) {
      localStorage.setItem('travelai_key', key);
      window.location.href = 'roman-agency-panel.html';
    } else {
      showAlert('Ключ не найден или неактивен', 'err');
    }
  } catch(e) {
    showAlert('Сервер недоступен. Попробуйте позже.', 'err');
  }
  btn.disabled = false; btn.textContent = 'Войти →';
}

async function loginByPass() {
  const email = document.getElementById('loginEmail').value.trim();
  const pass = document.getElementById('loginPass').value;
  if (!email || !pass) { showAlert('Заполните email и пароль', 'err'); return; }
  const btn = document.getElementById('btnPass');
  btn.disabled = true; btn.innerHTML = '<span class="sp"></span>Входим...';
  try {
    const res = await fetch(`${API}/api/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password: pass })
    });
    const data = await res.json();
    if (res.ok && data.api_key) {
      localStorage.setItem('travelai_key', data.api_key);
      window.location.href = 'roman-agency-panel.html';
    } else {
      showAlert(data.error || 'Неверный email или пароль', 'err');
    }
  } catch(e) {
    showAlert('Сервер недоступен. Попробуйте позже.', 'err');
  }
  btn.disabled = false; btn.textContent = 'Войти →';
}

// Если уже залогинен — редирект
if (localStorage.getItem('travelai_key')) {
  window.location.href = 'roman-agency-panel.html';
}
</script>
</body>
</html>
